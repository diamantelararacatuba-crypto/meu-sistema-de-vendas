<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gest√£o Financeira e Estoque</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Incluindo a biblioteca IMask para formata√ß√£o de inputs -->
    <script src="https://unpkg.com/imask"></script>
    <style>
        /* Estilos CSS gerais */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            padding: 2rem;
        }
        h1, h2 {
            font-weight: 700;
            color: #111827;
        }
        .card {
            background-color: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2rem;
        }
        .hidden {
            display: none !important;
        }
        .btn-primary {
            background-color: #4f46e5;
            color: white;
            padding: 1rem 2rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #4338ca;
        }
        .btn-secondary {
            background-color: #e5e7eb;
            color: #374151;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        .btn-secondary:hover {
            background-color: #d1d5db;
        }
        .btn-danger {
            background-color: #ef4444;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        .btn-danger:hover {
            background-color: #dc2626;
        }
        .back-btn-box {
            background-color: #ffffff;
            border-radius: 1rem;
            padding: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .back-btn-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4 md:p-8">
        <!-- T√≠tulo principal (sem a descri√ß√£o do dashboard) -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-extrabold text-indigo-900 mb-2">Sistema de Gest√£o Financeira</h1>
        </header>

        <!-- Container principal do conte√∫do -->
        <main class="flex justify-center">
            <!-- Menu Principal - inicialmente vis√≠vel -->
            <div id="main-menu" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 w-full max-w-4xl">
                <!-- Bot√£o para Cadastrar Clientes -->
                <button class="action-btn card flex flex-col items-center justify-center text-center p-6 transition-transform transform hover:scale-105" data-target="cadastrar-cliente-section">
                    <span class="text-5xl mb-4">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                    <h2 class="text-2xl font-bold mb-2">Cadastrar Cliente</h2>
                    <p class="text-gray-500">Adicionar novos clientes</p>
                </button>
                <!-- Bot√£o para Ver Clientes -->
                <button class="action-btn card flex flex-col items-center justify-center text-center p-6 transition-transform transform hover:scale-105" data-target="ver-clientes-section">
                    <span class="text-5xl mb-4">üë•</span>
                    <h2 class="text-2xl font-bold mb-2">Ver Clientes</h2>
                    <p class="text-gray-500">Visualizar e gerenciar clientes</p>
                </button>
                <!-- Bot√£o para Vendas e Promiss√≥rias -->
                <button class="action-btn card flex flex-col items-center justify-center text-center p-6 transition-transform transform hover:scale-105" data-target="vendas-section">
                    <span class="text-5xl mb-4">üìù</span>
                    <h2 class="text-2xl font-bold mb-2">Vendas e Promiss√≥rias</h2>
                    <p class="text-gray-500">Lan√ßar vendas e promiss√≥rias</p>
                </button>
                <!-- Bot√£o para Pr√≥ximos Vencimentos -->
                <button class="action-btn card flex flex-col items-center justify-center text-center p-6 transition-transform transform hover:scale-105" data-target="proximos-vencimentos-section">
                    <span class="text-5xl mb-4">üìÖ</span>
                    <h2 class="text-2xl font-bold mb-2">Pr√≥ximos Vencimentos</h2>
                    <p class="text-gray-500">Visualizar pagamentos pr√≥ximos</p>
                </button>
                <!-- Bot√£o para Controle de Estoque -->
                <button class="action-btn card flex flex-col items-center justify-center text-center p-6 transition-transform transform hover:scale-105" data-target="estoque-section">
                    <span class="text-5xl mb-4">üì¶</span>
                    <h2 class="text-2xl font-bold mb-2">Controle de Estoque</h2>
                    <p class="text-gray-500">Gerenciar produtos e dar baixa</p>
                </button>
                <!-- Bot√£o para Registrar Pagamento -->
                <button class="action-btn card flex flex-col items-center justify-center text-center p-6 transition-transform transform hover:scale-105" data-target="registrar-pagamento-section">
                    <span class="text-5xl mb-4">üí∞</span>
                    <h2 class="text-2xl font-bold mb-2">Registrar Pagamento</h2>
                    <p class="text-gray-500">Adicionar pagamentos de promiss√≥rias</p>
                </button>
                <!-- Bot√£o para Entrada de Nota Fiscal -->
                <button class="action-btn card flex flex-col items-center justify-center text-center p-6 transition-transform transform hover:scale-105" data-target="nota-fiscal-section">
                    <span class="text-5xl mb-4">üßæ</span>
                    <h2 class="text-2xl font-bold mb-2">Entrada de Nota Fiscal</h2>
                    <p class="text-gray-500">Registrar entrada de produtos por nota</p>
                </button>
            </div>

            <!-- Container para as se√ß√µes de conte√∫do - inicialmente oculto -->
            <div id="content-sections-container" class="hidden w-full max-w-4xl">
                <!-- Bot√£o para voltar ao menu com novo estilo de "caixinha" -->
                <div class="mb-6 flex justify-between items-center">
                    <button id="back-to-menu-btn" class="back-btn-box btn-secondary flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-5 w-5 mr-2">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        Voltar ao Menu Anterior
                    </button>
                    <h2 id="section-title" class="text-3xl font-bold text-gray-800"></h2>
                </div>

                <!-- Se√ß√£o: Cadastrar Clientes -->
                <div id="cadastrar-cliente-section" class="card hidden">
                    <h3 class="text-2xl font-bold mb-4">Cadastrar Cliente</h3>
                    <form id="cadastrar-cliente-form" class="space-y-4">
                        <div>
                            <label for="cliente-id" class="block text-gray-700 font-semibold mb-1">ID do Cliente</label>
                            <input type="text" id="cliente-id" class="w-full p-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed" disabled>
                        </div>
                        <div>
                            <label for="nome-cliente" class="block text-gray-700 font-semibold mb-1">Nome Completo</label>
                            <input type="text" id="nome-cliente" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label for="telefone-cliente" class="block text-gray-700 font-semibold mb-1">Telefone</label>
                            <input type="text" id="telefone-cliente" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="rg-cliente" class="block text-gray-700 font-semibold mb-1">RG</label>
                                <input type="text" id="rg-cliente" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="cpf-cliente" class="block text-gray-700 font-semibold mb-1">CPF</label>
                                <input type="text" id="cpf-cliente" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                        </div>
                        <div>
                            <label for="rua-cliente" class="block text-gray-700 font-semibold mb-1">Rua</label>
                            <input type="text" id="rua-cliente" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="numero-cliente" class="block text-gray-700 font-semibold mb-1">N√∫mero</label>
                                <input type="text" id="numero-cliente" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="complemento-cliente" class="block text-gray-700 font-semibold mb-1">Complemento</label>
                                <input type="text" id="complemento-cliente" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="bairro-cliente" class="block text-gray-700 font-semibold mb-1">Bairro</label>
                                <input type="text" id="bairro-cliente" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                        </div>
                        <div>
                            <label for="cidade-cliente" class="block text-gray-700 font-semibold mb-1">Cidade</label>
                            <input type="text" id="cidade-cliente" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <button type="submit" class="btn-primary w-full">Cadastrar Cliente</button>
                    </form>
                </div>
                
                <!-- Se√ß√£o: Ver Clientes -->
                <div id="ver-clientes-section" class="card hidden">
                    <h3 class="text-2xl font-bold mb-4">Ver Clientes</h3>
                    <div class="mb-4">
                        <label for="filtro-cidade" class="block text-gray-700 font-semibold mb-1">Filtrar por Cidade</label>
                        <input type="text" id="filtro-cidade" placeholder="Digite a cidade..." class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div id="ver-clientes-table-container" class="overflow-x-auto">
                        <!-- Tabela de clientes ser√° renderizada aqui via JS -->
                    </div>
                </div>

                <!-- Se√ß√£o: Vendas e Promiss√≥rias -->
                <div id="vendas-section" class="card hidden">
                    <h3 class="text-2xl font-bold mb-4">Vendas e Promiss√≥rias</h3>
                    <form id="venda-promissoria-form" class="space-y-4">
                        <div>
                            <label for="cliente-id-venda" class="block text-gray-700 font-semibold mb-1">ID do Cliente</label>
                            <input type="text" id="cliente-id-venda" placeholder="Digite o ID do cliente" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <span id="cliente-nome-venda" class="block mt-1 text-sm text-gray-500"></span>
                        </div>
                        <div>
                            <label for="data-venda" class="block text-gray-700 font-semibold mb-1">Data da Venda</label>
                            <input type="date" id="data-venda" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label for="data-vencimento" class="block text-gray-700 font-semibold mb-1">Data de Vencimento</label>
                            <input type="date" id="data-vencimento" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label for="valor-total-venda" class="block text-gray-700 font-semibold mb-1">Valor Total</label>
                            <input type="number" id="valor-total-venda" step="0.01" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label for="valor-pago-venda" class="block text-gray-700 font-semibold mb-1">Valor Pago (Entrada)</label>
                            <input type="number" id="valor-pago-venda" step="0.01" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <button type="submit" class="btn-primary w-full">Adicionar Venda</button>
                    </form>
                </div>
                
                <!-- Se√ß√£o: Pr√≥ximos Vencimentos -->
                <div id="proximos-vencimentos-section" class="card hidden">
                    <h3 class="text-2xl font-bold mb-4">Pr√≥ximos Vencimentos</h3>
                    <div id="proximos-vencimentos-container" class="space-y-4">
                        <!-- Itens de vencimento pr√≥ximos ser√£o renderizados aqui via JS -->
                    </div>
                </div>

                <!-- Se√ß√£o: Controle de Estoque -->
                <div id="estoque-section" class="card hidden">
                    <h3 class="text-2xl font-bold mb-4">Controle de Estoque</h3>
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-lg font-bold">Produtos em Estoque</h4>
                        <button id="add-product-btn" class="btn-primary py-2 px-4 text-sm">Adicionar Produto</button>
                    </div>
                    
                    <!-- Formul√°rio de adicionar produto (inicialmente oculto) -->
                    <form id="add-product-form" class="hidden space-y-4 mb-8 p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <div class="flex justify-between items-center">
                            <h4 class="text-xl font-bold">Novo Produto</h4>
                            <button type="button" id="cancel-add-product" class="text-gray-500 hover:text-gray-700">&times;</button>
                        </div>
                        <div>
                            <label for="product-id" class="block text-gray-700 font-semibold mb-1">C√≥digo do Produto (Opcional)</label>
                            <input type="text" id="product-id" placeholder="Gerado automaticamente se vazio" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label for="product-description" class="block text-gray-700 font-semibold mb-1">Descri√ß√£o</label>
                            <input type="text" id="product-description" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label for="product-quantity" class="block text-gray-700 font-semibold mb-1">Quantidade em Estoque</label>
                            <input type="number" id="product-quantity" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label for="product-price" class="block text-gray-700 font-semibold mb-1">Pre√ßo</label>
                            <input type="number" id="product-price" step="0.01" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label for="product-category" class="block text-gray-700 font-semibold mb-1">Categoria</label>
                            <select id="product-category" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="casa">Produtos de Casa</option>
                                <option value="alimenticio">Produto Aliment√≠cio</option>
                            </select>
                        </div>
                        <button type="submit" class="btn-primary w-full">Salvar Produto</button>
                    </form>

                    <div id="estoque-table-container" class="overflow-x-auto">
                        <!-- Tabela de estoque ser√° renderizada aqui via JS -->
                    </div>
                </div>
                
                <!-- Se√ß√£o: Registrar Pagamento -->
                <div id="registrar-pagamento-section" class="card hidden">
                    <h3 class="text-2xl font-bold mb-4">Registrar Pagamento</h3>
                    <form id="registrar-pagamento-form" class="space-y-4">
                        <div>
                            <label for="cliente-id-pagamento" class="block text-gray-700 font-semibold mb-1">ID do Cliente</label>
                            <input type="text" id="cliente-id-pagamento" placeholder="Digite o ID do cliente" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div id="pagamento-cliente-info" class="p-4 bg-gray-50 rounded-lg hidden">
                            <!-- Informa√ß√µes do cliente e d√≠vida ser√£o mostradas aqui -->
                        </div>
                        <div>
                            <label for="data-pagamento" class="block text-gray-700 font-semibold mb-1">Data do Pagamento</label>
                            <input type="date" id="data-pagamento" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label for="valor-pago-pagamento" class="block text-gray-700 font-semibold mb-1">Valor Pago</label>
                            <input type="number" id="valor-pago-pagamento" step="0.01" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <button type="submit" class="btn-primary w-full">Registrar Pagamento</button>
                    </form>
                </div>
                
                <!-- Se√ß√£o: Entrada de Nota Fiscal -->
                <div id="nota-fiscal-section" class="card hidden">
                    <h3 class="text-2xl font-bold mb-4">Entrada de Nota Fiscal</h3>
                    <div class="flex items-center space-x-4 mb-4">
                        <input type="text" id="invoiceNumber" placeholder="N√∫mero da Nota Fiscal" class="flex-1 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <button id="searchInvoiceBtn" class="btn-primary">Buscar</button>
                    </div>
                    <div id="invoiceDetails" class="card p-4">
                        <div class="text-center text-gray-500 p-4" id="invoice-placeholder">
                            <span class="text-4xl">üßæ</span>
                            <p class="mt-2">Aguardando a busca de uma nota fiscal...</p>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script>
        // --- V√ÅRIAVEIS GLOBAIS ---
        const mainMenu = document.getElementById('main-menu');
        const contentSectionsContainer = document.getElementById('content-sections-container');
        const actionButtons = document.querySelectorAll('.action-btn');
        const backToMenuBtn = document.getElementById('back-to-menu-btn');
        const allContentSections = document.querySelectorAll('#content-sections-container > div');
        const sectionTitle = document.getElementById('section-title');
        let appData;

        // --- DADOS SIMULADOS (Armazenados no localStorage) ---
        // Agora, o aplicativo come√ßa com dados vazios para clientes, produtos e vendas.
        function getInitialData() {
            return {
                clientes: [],
                produtos: [],
                vendas: []
            };
        }

        // Fun√ß√£o principal para carregar os dados
        function loadData() {
            let data = JSON.parse(localStorage.getItem('financeApp'));
            if (!data) {
                data = getInitialData();
                localStorage.setItem('financeApp', JSON.stringify(data));
            }
            appData = data;
        }

        // Fun√ß√£o para salvar os dados no localStorage
        function saveData() {
            localStorage.setItem('financeApp', JSON.stringify(appData));
        }

        // Renderiza a tabela de clientes
        function renderClientes(clientesToRender) {
            const tableContainer = document.getElementById('ver-clientes-table-container');
            if (!clientesToRender) {
                clientesToRender = appData.clientes;
            }
            
            if (clientesToRender.length === 0) {
                tableContainer.innerHTML = `<p class="text-center text-gray-500">Nenhum cliente cadastrado.</p>`;
                return;
            }

            let html = `
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Telefone</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cidade</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
            `;
            clientesToRender.forEach(cliente => {
                html += `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">${cliente.id}</td>
                        <td class="px-6 py-4 whitespace-nowrap">${cliente.nome}</td>
                        <td class="px-6 py-4 whitespace-nowrap">${cliente.telefone}</td>
                        <td class="px-6 py-4 whitespace-nowrap">${cliente.cidade}</td>
                    </tr>
                `;
            });
            html += `
                    </tbody>
                </table>
            `;
            tableContainer.innerHTML = html;
        }

        // Renderiza a tabela de produtos em estoque
        function renderEstoque(produtos) {
            const tableContainer = document.getElementById('estoque-table-container');
            
            if (produtos.length === 0) {
                tableContainer.innerHTML = `<p class="text-center text-gray-500">Nenhum produto no estoque.</p>`;
                return;
            }

            let html = `
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Produto</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantidade</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pre√ßo</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
            `;
            produtos.forEach(produto => {
                html += `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">${produto.id}</td>
                        <td class="px-6 py-4 whitespace-nowrap">${produto.nome}</td>
                        <td class="px-6 py-4 whitespace-nowrap">${produto.quantidade}</td>
                        <td class="px-6 py-4 whitespace-nowrap">R$ ${produto.preco.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <button class="btn-danger py-1 px-2 text-xs" onclick="darBaixaProduto('${produto.id}')">Dar Sa√≠da</button>
                        </td>
                    </tr>
                `;
            });
            html += `
                    </tbody>
                </table>
            `;
            tableContainer.innerHTML = html;
        }

        // Fun√ß√£o de busca de nota fiscal (placeholder)
        function searchInvoice() {
            const invoiceNumberInput = document.getElementById('invoiceNumber');
            const invoiceDetailsDiv = document.getElementById('invoiceDetails');
            const invoiceNumber = invoiceNumberInput.value.toLowerCase();

            // Esta √© uma simula√ß√£o da busca. Em uma aplica√ß√£o real, voc√™ faria uma chamada para a API.
            const fornecedores = {
                'nf-123': { nome: 'Fornecedor Exemplo', produtos: [{ desc: 'Caneta', qtd: 50 }, { desc: 'Caderno', qtd: 20 }] },
                'nf-456': { nome: 'Fornecedor B', produtos: [{ desc: 'Lapis', qtd: 100 }, { desc: 'Borracha', qtd: 80 }] }
            };

            const invoice = fornecedores[invoiceNumber];

            if (invoice) {
                invoiceDetailsDiv.innerHTML = `
                    <div class="p-6">
                        <h4 class="text-xl font-bold text-gray-800 mb-2">Detalhes da Nota Fiscal: ${invoiceNumber.toUpperCase()}</h4>
                        <p><strong>Fornecedor:</strong> ${invoice.nome}</p>
                        <h5 class="text-lg font-semibold mt-4">Produtos:</h5>
                        <ul class="list-disc list-inside mt-2">
                            ${invoice.produtos.map(item => `<li>${item.qtd}x ${item.desc}</li>`).join('')}
                        </ul>
                    </div>
                `;
            } else {
                invoiceDetailsDiv.innerHTML = `
                    <div class="text-center text-gray-500 p-4">
                        <span class="text-4xl">‚ùå</span>
                        <p class="mt-2">Nota fiscal n√£o encontrada.</p>
                    </div>
                `;
            }
        }
        
        // Fun√ß√£o para mostrar ou ocultar se√ß√µes
        function showSection(targetSectionId) {
            mainMenu.classList.add('hidden');
            contentSectionsContainer.classList.remove('hidden');

            allContentSections.forEach(section => {
                section.classList.add('hidden');
            });
            
            const targetSection = document.getElementById(targetSectionId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
                const buttonTitle = document.querySelector(`[data-target="${targetSectionId}"] h2`).textContent;
                sectionTitle.textContent = buttonTitle;

                if (targetSectionId === 'ver-clientes-section') {
                    renderClientes();
                } else if (targetSectionId === 'estoque-section') {
                    renderEstoque(appData.produtos);
                }
            }
        }

        // Fun√ß√£o para dar baixa em um produto
        function darBaixaProduto(produtoId) {
            const produto = appData.produtos.find(p => p.id === produtoId);
            if (!produto) {
                console.error("Produto n√£o encontrado.");
                return;
            }

            const quantidade = prompt(`Quantas unidades de "${produto.nome}" voc√™ quer retirar do estoque?`);
            const quantidadeNumerica = parseInt(quantidade, 10);

            if (quantidadeNumerica > 0 && quantidadeNumerica <= produto.quantidade) {
                produto.quantidade -= quantidadeNumerica;
                saveData();
                renderEstoque(appData.produtos);
                alert(`${quantidadeNumerica} unidades de "${produto.nome}" foram retiradas do estoque.`);
            } else if (quantidade !== null) {
                alert("Quantidade inv√°lida ou insuficiente.");
            }
        }

        // Fun√ß√£o para cadastrar novo cliente
        function cadastrarCliente(event) {
            event.preventDefault();
            const form = event.target;
            const nome = form['nome-cliente'].value;
            const telefone = form['telefone-cliente'].value;
            const rg = form['rg-cliente'].value;
            const cpf = form['cpf-cliente'].value;
            const rua = form['rua-cliente'].value;
            const numero = form['numero-cliente'].value;
            const complemento = form['complemento-cliente'].value;
            const bairro = form['bairro-cliente'].value;
            const cidade = form['cidade-cliente'].value;

            const newId = appData.clientes.length > 0 ? Math.max(...appData.clientes.map(c => c.id)) + 1 : 1;

            const novoCliente = {
                id: newId,
                nome,
                telefone,
                rg,
                cpf,
                rua,
                numero,
                complemento,
                bairro,
                cidade
            };

            appData.clientes.push(novoCliente);
            saveData();
            alert(`Cliente ${nome} cadastrado com sucesso! ID: ${newId}`);
            form.reset();
            document.getElementById('cliente-id').value = newId + 1;
        }

        // Fun√ß√£o para cadastrar novo produto
        function cadastrarProduto(event) {
            event.preventDefault();
            const form = event.target;
            let id = form['product-id'].value;
            const nome = form['product-description'].value;
            const quantidade = parseInt(form['product-quantity'].value, 10);
            const preco = parseFloat(form['product-price'].value);
            const categoria = form['product-category'].value;

            if (!id) {
                const newIdNum = appData.produtos.length > 0 ? Math.max(...appData.produtos.map(p => parseInt(p.id.split('-')[1]))) + 1 : 1;
                id = `PROD-${newIdNum.toString().padStart(3, '0')}`;
            }

            const novoProduto = {
                id,
                nome,
                quantidade,
                preco,
                categoria
            };
            
            appData.produtos.push(novoProduto);
            saveData();
            alert(`Produto "${nome}" adicionado ao estoque!`);
            form.reset();
            renderEstoque(appData.produtos);
            document.getElementById('add-product-form').classList.add('hidden');
        }

        // Fun√ß√£o para adicionar nova venda
        function adicionarVenda(event) {
            event.preventDefault();
            const form = event.target;
            const idCliente = parseInt(form['cliente-id-venda'].value, 10);
            const dataVenda = form['data-venda'].value;
            const dataVencimento = form['data-vencimento'].value;
            const valorTotal = parseFloat(form['valor-total-venda'].value);
            const valorPago = parseFloat(form['valor-pago-venda'].value) || 0;

            const cliente = appData.clientes.find(c => c.id === idCliente);
            if (!cliente) {
                alert("Cliente n√£o encontrado.");
                return;
            }

            const newId = appData.vendas.length > 0 ? Math.max(...appData.vendas.map(v => v.id)) + 1 : 1;

            const novaVenda = {
                id: newId,
                idCliente,
                dataVenda,
                dataVencimento,
                valorTotal,
                valorPago
            };
            
            appData.vendas.push(novaVenda);
            saveData();
            alert(`Venda para ${cliente.nome} adicionada com sucesso!`);
            form.reset();
        }

        // Fun√ß√£o para registrar pagamento
        function registrarPagamento(event) {
            event.preventDefault();
            const form = event.target;
            const idCliente = parseInt(form['cliente-id-pagamento'].value, 10);
            const dataPagamento = form['data-pagamento'].value;
            const valorPago = parseFloat(form['valor-pago-pagamento'].value);

            const venda = appData.vendas.find(v => v.idCliente === idCliente && v.valorPago < v.valorTotal);
            if (!venda) {
                alert("Nenhuma promiss√≥ria em aberto encontrada para este cliente.");
                return;
            }

            venda.valorPago += valorPago;
            saveData();

            const valorFaltaPagar = venda.valorTotal - venda.valorPago;
            if (valorFaltaPagar <= 0) {
                alert(`Pagamento registrado. Promiss√≥ria de ${venda.valorTotal} para o cliente ${idCliente} est√° quitada!`);
            } else {
                alert(`Pagamento de R$ ${valorPago.toFixed(2)} registrado. Falta pagar: R$ ${valorFaltaPagar.toFixed(2)}`);
            }
            form.reset();
            document.getElementById('pagamento-cliente-info').classList.add('hidden');
        }

        // Renderiza os pr√≥ximos vencimentos
        function renderProximosVencimentos() {
            const container = document.getElementById('proximos-vencimentos-container');
            const hoje = new Date();
            const proximosVencimentos = appData.vendas.filter(venda => {
                const dataVencimento = new Date(venda.dataVencimento);
                const diffTime = dataVencimento - hoje;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays >= 0 && diffDays <= 7 && venda.valorPago < venda.valorTotal;
            });
            
            if (proximosVencimentos.length === 0) {
                container.innerHTML = `<p class="text-center text-gray-500">Nenhum vencimento pr√≥ximo nos pr√≥ximos 7 dias.</p>`;
                return;
            }

            let html = '';
            proximosVencimentos.forEach(venda => {
                const cliente = appData.clientes.find(c => c.id === venda.idCliente);
                const diasRestantes = Math.ceil((new Date(venda.dataVencimento) - new Date()) / (1000 * 60 * 60 * 24));
                html += `
                    <div class="p-4 rounded-lg bg-yellow-100 border border-yellow-300">
                        <p class="font-bold text-lg">${cliente.nome}</p>
                        <p>Vencimento: ${venda.dataVencimento}</p>
                        <p>Falta pagar: R$ ${(venda.valorTotal - venda.valorPago).toFixed(2)}</p>
                        <p class="text-sm mt-1 text-gray-600">Faltam ${diasRestantes} dias</p>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // Event listeners
        actionButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                const target = e.currentTarget.dataset.target;
                showSection(target);
                if (target === 'cadastrar-cliente-section') {
                    const nextId = appData.clientes.length > 0 ? Math.max(...appData.clientes.map(c => c.id)) + 1 : 1;
                    document.getElementById('cliente-id').value = nextId;
                } else if (target === 'proximos-vencimentos-section') {
                    renderProximosVencimentos();
                }
            });
        });

        backToMenuBtn.addEventListener('click', () => {
            mainMenu.classList.remove('hidden');
            contentSectionsContainer.classList.add('hidden');
            document.getElementById('filtro-cidade').value = '';
        });

        // Event Listeners para formul√°rios
        document.getElementById('cadastrar-cliente-form').addEventListener('submit', cadastrarCliente);
        document.getElementById('venda-promissoria-form').addEventListener('submit', adicionarVenda);
        document.getElementById('registrar-pagamento-form').addEventListener('submit', registrarPagamento);
        document.getElementById('add-product-form').addEventListener('submit', cadastrarProduto);
        document.getElementById('add-product-btn').addEventListener('click', () => {
            document.getElementById('add-product-form').classList.remove('hidden');
        });
        document.getElementById('cancel-add-product').addEventListener('click', () => {
            document.getElementById('add-product-form').classList.add('hidden');
        });
        document.getElementById('searchInvoiceBtn').addEventListener('click', searchInvoice);

        // Event listeners para formata√ß√£o de inputs
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            IMask(
                document.getElementById('telefone-cliente'), { mask: '(00) 00000-0000' }
            );
            IMask(
                document.getElementById('cpf-cliente'), { mask: '000.000.000-00' }
            );
            IMask(
                document.getElementById('rg-cliente'), { mask: '00.000.000-0' }
            );
        });

        // Event listener para filtrar clientes por cidade
        document.getElementById('filtro-cidade').addEventListener('input', (e) => {
            const termo = e.target.value.toLowerCase();
            const clientesFiltrados = appData.clientes.filter(cliente => cliente.cidade.toLowerCase().includes(termo));
            renderClientes(clientesFiltrados);
        });

        // Event listener para buscar cliente na venda
        document.getElementById('cliente-id-venda').addEventListener('input', (e) => {
            const id = parseInt(e.target.value, 10);
            const cliente = appData.clientes.find(c => c.id === id);
            const clienteNomeSpan = document.getElementById('cliente-nome-venda');
            if (cliente) {
                clienteNomeSpan.textContent = `Cliente: ${cliente.nome}`;
            } else {
                clienteNomeSpan.textContent = `Cliente n√£o encontrado`;
            }
        });

        // Event listener para buscar cliente no pagamento
        document.getElementById('cliente-id-pagamento').addEventListener('input', (e) => {
            const id = parseInt(e.target.value, 10);
            const cliente = appData.clientes.find(c => c.id === id);
            const pagamentoInfoDiv = document.getElementById('pagamento-cliente-info');
            if (cliente) {
                const venda = appData.vendas.find(v => v.idCliente === id && v.valorPago < v.valorTotal);
                if (venda) {
                    pagamentoInfoDiv.classList.remove('hidden');
                    pagamentoInfoDiv.innerHTML = `
                        <p class="font-bold">Cliente: ${cliente.nome}</p>
                        <p>Valor total da d√≠vida: R$ ${venda.valorTotal.toFixed(2)}</p>
                        <p>Valor j√° pago: R$ ${venda.valorPago.toFixed(2)}</p>
                        <p>Falta pagar: R$ ${(venda.valorTotal - venda.valorPago).toFixed(2)}</p>
                    `;
                } else {
                    pagamentoInfoDiv.classList.remove('hidden');
                    pagamentoInfoDiv.innerHTML = `<p class="text-red-500">Este cliente n√£o tem promiss√≥rias em aberto.</p>`;
                }
            } else {
                pagamentoInfoDiv.classList.add('hidden');
            }
        });
    </script>
</body>
</html>